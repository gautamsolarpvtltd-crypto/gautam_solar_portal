<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin - Analytics</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark">
        <div class="container-fluid">
            <span class="navbar-brand">Analytics Dashboard</span>
            <a href="/admin/dashboard" class="btn btn-outline-light btn-sm">Back to Dashboard</a>
        </div>
    </nav>

    <div class="container mt-4">
        <h2>Analytics & Statistics</h2>
        
        <div id="analyticsData">
            <div class="text-center">
                <div class="spinner-border" role="status"></div>
                <p>Loading analytics...</p>
            </div>
        </div>
    </div>

    <script>
    async function loadAnalytics() {
        try {
            const response = await fetch('/api/admin/analytics');
            const data = await response.json();
            
            if (data.success) {
                let html = '<div class="row g-4">';
                
                // User Stats
                html += `
                    <div class="col-md-3">
                        <div class="card text-white bg-primary">
                            <div class="card-body">
                                <h5>Total Users</h5>
                                <h2>${data.users.total}</h2>
                                <small>Approved: ${data.users.approved}</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-white bg-success">
                            <div class="card-body">
                                <h5>Total Downloads</h5>
                                <h2>${data.downloads.total}</h2>
                                <small>Today: ${data.downloads.today}</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-white bg-info">
                            <div class="card-body">
                                <h5>Products</h5>
                                <h2>${data.products.total}</h2>
                                <small>Available: ${data.products.available}</small>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="card text-white bg-warning">
                            <div class="card-body">
                                <h5>Today's Registrations</h5>
                                <h2>${data.users.today}</h2>
                            </div>
                        </div>
                    </div>
                `;
                
                html += '</div>';
                
                // Top Documents
                if (data.top_documents && data.top_documents.length > 0) {
                    html += '<div class="card mt-4"><div class="card-body">';
                    html += '<h5>Most Downloaded Documents</h5>';
                    html += '<ul class="list-group">';
                    data.top_documents.forEach(doc => {
                        html += `<li class="list-group-item d-flex justify-content-between">
                            <span>${doc.name}</span>
                            <span class="badge bg-primary">${doc.downloads} downloads</span>
                        </li>`;
                    });
                    html += '</ul></div></div>';
                }
                
                document.getElementById('analyticsData').innerHTML = html;
            }
        } catch (error) {
            document.getElementById('analyticsData').innerHTML = 
                '<div class="alert alert-danger">Error loading analytics</div>';
        }
    }
    
    loadAnalytics();
    </script>
</body>
</html>